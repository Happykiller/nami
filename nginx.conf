# Fronts
server {
    listen 8080;
    listen [::]:8080;
    root /root/for/lilith.happykiller.net;
}

server {
    listen 8081;
    listen [::]:8081;
    root /root/for/stella.happykiller.net;
}

server {
    listen 8082;
    listen [::]:8082;
    root /root/for/wiki.happykiller.net;
}

server {
    listen 8083;
    listen [::]:8083;
    root /root/for/gold.happykiller.net;
}

# Backs
server {
    listen 3000;
    listen [::]:3000;
    root /root/for/api.lilith.happykiller.net;
}

server {
    listen 3001;
    listen [::]:3001;
    root /root/for/api.gold.happykiller.net;
}

# Servers
server {
    listen 80;
    listen [::]:80;

    server_name happykiller.net 
        www.happykiller.net 
        wiki.happykiller.net 
        lilith.happykiller.net 
        stella.happykiller.net 
        gold.happykiller.net 
        api.lilith.happykiller.net
        siguri.happykiller.net 
        api.siguri.happykiller.net 
        api.gold.happykiller.net;
    server_tokens off;

    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }

    location / {
        return 301 https://$host$request_uri;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2  on;

    server_name happykiller.net;

    ssl_certificate /etc/letsencrypt/live/happykiller.net/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/happykiller.net/privkey.pem;
    
    location / {
    	proxy_pass http://happykiller.net;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2  on;

    server_name lilith.happykiller.net;

    ssl_certificate /etc/letsencrypt/live/lilith.happykiller.net/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/lilith.happykiller.net/privkey.pem;

    location / {
        proxy_pass http://host.docker.internal:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2  on;

    server_name api.lilith.happykiller.net;

    ssl_certificate /etc/letsencrypt/live/api.lilith.happykiller.net/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.lilith.happykiller.net/privkey.pem;

    location /graphql {
        proxy_pass http://host.docker.internal:3000/graphql;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $remote_addr;
    }

    location /websocket {
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_pass http://host.docker.internal:3000/graphql;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2  on;

    server_name stella.happykiller.net;

    ssl_certificate /etc/letsencrypt/live/stella.happykiller.net/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/stella.happykiller.net/privkey.pem;

    location / {
        proxy_pass http://host.docker.internal:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2  on;

    ssl_certificate /etc/letsencrypt/live/wiki.happykiller.net/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/wiki.happykiller.net/privkey.pem;

    server_name wiki.happykiller.net;

    location / {
        proxy_pass http://host.docker.internal:8082;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2  on;

    server_name gold.happykiller.net;

    ssl_certificate /etc/letsencrypt/live/gold.happykiller.net/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/gold.happykiller.net/privkey.pem;

    location / {
        proxy_pass http://host.docker.internal:8083;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2  on;

    server_name api.gold.happykiller.net;

    ssl_certificate /etc/letsencrypt/live/api.gold.happykiller.net/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.gold.happykiller.net/privkey.pem;

    location / {
        proxy_pass http://host.docker.internal:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $remote_addr;
    }
}